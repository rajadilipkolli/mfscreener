package com.learning.mfscreener.web.controllers;

import static org.hamcrest.Matchers.is;
import static org.hamcrest.Matchers.notNullValue;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.multipart;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.header;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import com.learning.mfscreener.common.AbstractIntegrationTest;
import com.learning.mfscreener.utils.TestData;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDate;
import org.junit.jupiter.api.MethodOrderer;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestMethodOrder;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.mock.web.MockMultipartFile;

@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
class PortfolioControllerIT extends AbstractIntegrationTest {

    @Test
    @Order(1)
    void uploadFile() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO(false, false, false)));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 1 folios and 5 transactions")))
                    .andExpect(jsonPath("$.summaryByFY.FY2022-23", notNullValue()));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(2)
    void uploadFileWithNoChanges() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO(false, false, false)));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Nothing to Update")));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(3)
    void uploadFileWithNewFolio() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO(true, false, false)));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 1 folios and 1 transactions")));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(4)
    void uploadFileWithNewScheme() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO(true, true, false)));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 0 folios and 6 transactions")))
                    .andExpect(jsonPath("$.summaryByFY.FY2022-23", notNullValue()));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(5)
    void uploadFileWithNewTransaction() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO(true, true, true)));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 0 folios and 1 transactions")));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(6)
    void uploadFileWithNewFolioAndSchemeAndTransaction() throws Exception {

        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(objectMapper.writeValueAsString(TestData.getCasDTO()));
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 1 folios and 3 transactions")));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    @Test
    @Order(7)
    void addMultipleSchemesAndTransactions() throws Exception {
        File tempFile = File.createTempFile("file", ".json");
        FileWriter fileWriter = getFileWriter(tempFile);
        fileWriter.close();

        try (FileInputStream fileInputStream = new FileInputStream(tempFile)) {

            // Create a MockMultipartFile object
            MockMultipartFile multipartFile = new MockMultipartFile(
                    "file", // parameter name expected by the controller
                    "file.json", // original file name
                    MediaType.APPLICATION_JSON_VALUE, // content type
                    fileInputStream);

            // Perform the file upload request
            mockMvc.perform(multipart("/api/portfolio/upload").file(multipartFile))
                    .andExpect(status().isOk())
                    .andExpect(content().contentType(MediaType.APPLICATION_JSON))
                    .andExpect(jsonPath("$.importSummary", is("Imported 1 folios and 270 transactions")));
        } finally {
            tempFile.deleteOnExit();
        }
    }

    private static FileWriter getFileWriter(File tempFile) throws IOException {
        FileWriter fileWriter = new FileWriter(tempFile);
        fileWriter.write(
                """
                    {"cas_type": "DETAILED", "file_type": "CAMS", "folios": [{"amc": "ICICI Prudential Mutual Fund", "folio": "30358614 / 77", "KYC": "OK", "PAN": "ABCDE1234F", "PANKYC": "OK", "schemes": [{"advisor": "INA100006898", "amfi": "120692", "close": 0.021, "close_calculated": 0.021, "isin": "INF109K016B1", "open": 0.0, "rta": "CAMS", "rta_code": "P8078", "scheme": "ICICI Prudential Corporate Bond Fund - Direct Plan - Growth (Non-Demat) - ISIN: INF 109K016B1", "transactions": [{"amount": 1656.92, "balance": 59.303, "date": "2024-03-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 27.9399, "type": "PURCHASE", "units": 59.303}, {"amount": 0.08, "balance": null, "date": "2024-03-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 310.98, "balance": 70.427, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 27.9568, "type": "PURCHASE", "units": 11.124}, {"amount": 0.02, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 9260.54, "balance": 401.608, "date": "2024-03-05", "description": "Switch In - From Regular Gold SF (FOF) - DP Growth - INA100006898", "dividend_rate": null, "nav": 27.9622, "type": "SWITCH_IN", "units": 331.181}, {"amount": 0.46, "balance": null, "date": "2024-03-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -5673.17, "balance": 199.227, "date": "2024-03-12", "description": "Switch Out - To Regular Gold SF (FOF) - DP Growth", "dividend_rate": null, "nav": 28.0321, "type": "SWITCH_OUT", "units": -202.381}, {"amount": -5584.17, "balance": 0.021, "date": "2024-03-12", "description": "Switch Out - To Nifty Next 50 Index Fund-DP Growth", "dividend_rate": null, "nav": 28.0321, "type": "SWITCH_OUT", "units": -199.206}], "type": "DEBT", "valuation": {"date": "2024-04-12", "nav": 28.1724, "value": 0}}, {"advisor": "INA100006898", "amfi": "120620", "close": 370.793, "close_calculated": 370.793, "isin": "INF109K012M7", "open": 0.0, "rta": "CAMS", "rta_code": "P8189", "scheme": "ICICI Prudential Nifty 50 Index Fund - Direct Plan Growth (Non-Demat) - ISIN: INF109K012M7", "transactions": [{"amount": 2188.89, "balance": 9.764, "date": "2024-01-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 224.1853, "type": "PURCHASE", "units": 9.764}, {"amount": 0.11, "balance": null, "date": "2024-01-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 14.661, "date": "2024-01-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 223.4005, "type": "PURCHASE", "units": 4.897}, {"amount": 0.05, "balance": null, "date": "2024-01-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 19.596, "date": "2024-01-03", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 221.8698, "type": "PURCHASE", "units": 4.935}, {"amount": 0.05, "balance": null, "date": "2024-01-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 3283.84, "balance": 34.3, "date": "2024-01-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 223.3233, "type": "PURCHASE", "units": 14.704}, {"amount": 0.16, "balance": null, "date": "2024-01-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1531.92, "balance": 41.143, "date": "2024-01-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 223.8605, "type": "PURCHASE", "units": 6.843}, {"amount": 0.08, "balance": null, "date": "2024-01-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1795.91, "balance": 49.227, "date": "2024-01-09", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 222.1446, "type": "PURCHASE", "units": 8.084}, {"amount": 0.09, "balance": null, "date": "2024-01-09", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 54.128, "date": "2024-01-11", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 223.1968, "type": "PURCHASE", "units": 4.901}, {"amount": 0.05, "balance": null, "date": "2024-01-11", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1053.95, "balance": 58.754, "date": "2024-01-15", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 227.8289, "type": "PURCHASE", "units": 4.626}, {"amount": 0.05, "balance": null, "date": "2024-01-15", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1046.95, "balance": 63.363, "date": "2024-01-16", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 227.1573, "type": "PURCHASE", "units": 4.609}, {"amount": 0.05, "balance": null, "date": "2024-01-16", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1295.94, "balance": 69.279, "date": "2024-01-23", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 219.0645, "type": "PURCHASE", "units": 5.916}, {"amount": 0.06, "balance": null, "date": "2024-01-23", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -1115.0, "balance": 64.24, "date": "2024-01-24", "description": "*Switch Out - To Nifty Next 50 Index Fund-DP Growth , less STT", "dividend_rate": null, "nav": 221.2847, "type": "SWITCH_OUT", "units": -5.039}, {"amount": 0.01, "balance": null, "date": "2024-01-24", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 645.97, "balance": 67.121, "date": "2024-01-29", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 224.201, "type": "PURCHASE", "units": 2.881}, {"amount": 0.03, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -7201.0, "balance": 34.942, "date": "2024-02-01", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 223.7828, "type": "SWITCH_OUT", "units": -32.179}, {"amount": 0.07, "balance": null, "date": "2024-02-01", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 489.98, "balance": 37.124, "date": "2024-02-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 224.5456, "type": "PURCHASE", "units": 2.182}, {"amount": 0.02, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 29992.5, "balance": 167.154, "date": "2024-03-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 230.659, "type": "PURCHASE", "units": 130.03}, {"amount": 1.5, "balance": null, "date": "2024-03-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 171.887, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 231.3438, "type": "PURCHASE", "units": 4.733}, {"amount": 0.05, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 8746.56, "balance": 209.815, "date": "2024-03-12", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 230.611, "type": "PURCHASE", "units": 37.928}, {"amount": 0.44, "balance": null, "date": "2024-03-12", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 4999.75, "balance": 232.011, "date": "2024-03-19", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 225.2588, "type": "PURCHASE", "units": 22.196}, {"amount": 0.25, "balance": null, "date": "2024-03-19", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 16352.18, "balance": 303.964, "date": "2024-03-21", "description": "Switch In - From Nifty Midcap 150 Index Fund - Direct Plan - Growth - INA100006898", "dividend_rate": null, "nav": 227.2605, "type": "SWITCH_IN", "units": 71.953}, {"amount": 0.82, "balance": null, "date": "2024-03-21", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -39644.0, "balance": 132.974, "date": "2024-04-01", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 231.8526, "type": "SWITCH_OUT", "units": -170.99}, {"amount": 0.4, "balance": null, "date": "2024-04-01", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 16597.17, "balance": 203.658, "date": "2024-04-10", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 234.808, "type": "PURCHASE", "units": 70.684}, {"amount": 0.83, "balance": null, "date": "2024-04-10", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 38839.06, "balance": 370.793, "date": "2024-04-12", "description": "Equity Switch In - From Nifty Next 50 Index Fund-DP Growth - INA100006898", "dividend_rate": null, "nav": 232.3817, "type": "SWITCH_IN", "units": 167.135}, {"amount": 1.94, "balance": null, "date": "2024-04-12", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}], "type": "EQUITY", "valuation": {"date": "2024-04-12", "nav": 232.3817, "value": 0}}, {"advisor": "INA100006898", "amfi": "149389", "close": 1991.187, "close_calculated": 1991.187, "isin": "INF109KC1W58", "open": 0.0, "rta": "CAMS", "rta_code": "P9662", "scheme": "ICICI Prudential Nifty Midcap 150 Index Fund - Direct Plan - Growth (Non-Demat) - ISIN: INF109KC1W58", "transactions": [{"amount": 2188.89, "balance": 143.096, "date": "2024-01-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.2967, "type": "PURCHASE", "units": 143.096}, {"amount": 0.11, "balance": null, "date": "2024-01-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 214.72, "date": "2024-01-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.2735, "type": "PURCHASE", "units": 71.624}, {"amount": 0.05, "balance": null, "date": "2024-01-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 286.236, "date": "2024-01-03", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.3105, "type": "PURCHASE", "units": 71.516}, {"amount": 0.05, "balance": null, "date": "2024-01-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 3283.84, "balance": 497.611, "date": "2024-01-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.5356, "type": "PURCHASE", "units": 211.375}, {"amount": 0.16, "balance": null, "date": "2024-01-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1531.92, "balance": 595.904, "date": "2024-01-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.5853, "type": "PURCHASE", "units": 98.293}, {"amount": 0.08, "balance": null, "date": "2024-01-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1715.91, "balance": 706.752, "date": "2024-01-09", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.4799, "type": "PURCHASE", "units": 110.848}, {"amount": 0.09, "balance": null, "date": "2024-01-09", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1097.95, "balance": 777.201, "date": "2024-01-11", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.585, "type": "PURCHASE", "units": 70.449}, {"amount": 0.05, "balance": null, "date": "2024-01-11", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1116.94, "balance": 848.239, "date": "2024-01-15", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.7232, "type": "PURCHASE", "units": 71.038}, {"amount": 0.06, "balance": null, "date": "2024-01-15", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 918.103, "date": "2024-01-16", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.6725, "type": "PURCHASE", "units": 69.864}, {"amount": 0.05, "balance": null, "date": "2024-01-16", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 980.95, "balance": 982.136, "date": "2024-01-23", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.3195, "type": "PURCHASE", "units": 64.033}, {"amount": 0.05, "balance": null, "date": "2024-01-23", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1707.91, "balance": 1091.77, "date": "2024-01-24", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.5783, "type": "PURCHASE", "units": 109.634}, {"amount": 0.09, "balance": null, "date": "2024-01-24", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1203.94, "balance": 1168.299, "date": "2024-01-29", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.7319, "type": "PURCHASE", "units": 76.529}, {"amount": 0.06, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 11839.41, "balance": 1916.062, "date": "2024-02-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.8331, "type": "PURCHASE", "units": 747.763}, {"amount": 0.59, "balance": null, "date": "2024-02-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1241.94, "balance": 1994.109, "date": "2024-02-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.9128, "type": "PURCHASE", "units": 78.047}, {"amount": 0.06, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 6744.66, "balance": 2415.337, "date": "2024-03-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 16.0119, "type": "PURCHASE", "units": 421.228}, {"amount": 0.34, "balance": null, "date": "2024-03-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 2483.212, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 16.1319, "type": "PURCHASE", "units": 67.875}, {"amount": 0.05, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 8780.56, "balance": 3040.605, "date": "2024-03-12", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.7529, "type": "PURCHASE", "units": 557.393}, {"amount": 0.44, "balance": null, "date": "2024-03-12", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -16353.0, "balance": 1962.165, "date": "2024-03-19", "description": "*Switch Out - To Nifty 50 Index Fund-DP Growth , less STT", "dividend_rate": null, "nav": 15.1637, "type": "SWITCH_OUT", "units": -1078.44}, {"amount": 0.16, "balance": null, "date": "2024-03-19", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": -3822.0, "balance": 1710.113, "date": "2024-03-19", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 15.1637, "type": "SWITCH_OUT", "units": -252.052}, {"amount": 0.04, "balance": null, "date": "2024-03-19", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 3349.83, "balance": 1915.82, "date": "2024-04-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 16.2845, "type": "PURCHASE", "units": 205.707}, {"amount": 0.17, "balance": null, "date": "2024-04-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1249.94, "balance": 1991.187, "date": "2024-04-10", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 16.5847, "type": "PURCHASE", "units": 75.367}, {"amount": 0.06, "balance": null, "date": "2024-04-10", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}], "type": "EQUITY", "valuation": {"date": "2024-04-12", "nav": 16.5033, "value": 0}}, {"advisor": "INA100006898", "amfi": "120684", "close": 741.763, "close_calculated": 741.763, "isin": "INF109K01Y80", "open": 0.0, "rta": "CAMS", "rta_code": "P8107", "scheme": "ICICI Prudential Nifty Next 50 Index Fund - Direct Plan - Growth (Non-Demat) - ISIN: INF109K01Y80", "transactions": [{"amount": 2188.89, "balance": 44.435, "date": "2024-01-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.261, "type": "PURCHASE", "units": 44.435}, {"amount": 0.11, "balance": null, "date": "2024-01-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 66.718, "date": "2024-01-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.1388, "type": "PURCHASE", "units": 22.283}, {"amount": 0.05, "balance": null, "date": "2024-01-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 88.834, "date": "2024-01-03", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.5092, "type": "PURCHASE", "units": 22.116}, {"amount": 0.05, "balance": null, "date": "2024-01-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 3283.84, "balance": 154.333, "date": "2024-01-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.1355, "type": "PURCHASE", "units": 65.499}, {"amount": 0.16, "balance": null, "date": "2024-01-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1531.92, "balance": 184.925, "date": "2024-01-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.0755, "type": "PURCHASE", "units": 30.592}, {"amount": 0.08, "balance": null, "date": "2024-01-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1759.91, "balance": 220.289, "date": "2024-01-09", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.7651, "type": "PURCHASE", "units": 35.364}, {"amount": 0.09, "balance": null, "date": "2024-01-09", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1079.95, "balance": 241.738, "date": "2024-01-11", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.3489, "type": "PURCHASE", "units": 21.449}, {"amount": 0.05, "balance": null, "date": "2024-01-11", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1069.95, "balance": 262.858, "date": "2024-01-15", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.6613, "type": "PURCHASE", "units": 21.12}, {"amount": 0.05, "balance": null, "date": "2024-01-15", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1115.94, "balance": 284.934, "date": "2024-01-16", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.5506, "type": "PURCHASE", "units": 22.076}, {"amount": 0.06, "balance": null, "date": "2024-01-16", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1052.95, "balance": 306.36, "date": "2024-01-23", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.1442, "type": "PURCHASE", "units": 21.426}, {"amount": 0.05, "balance": null, "date": "2024-01-23", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 582.97, "balance": 318.023, "date": "2024-01-24", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 49.9857, "type": "PURCHASE", "units": 11.663}, {"amount": 0.03, "balance": null, "date": "2024-01-24", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1202.94, "balance": 341.738, "date": "2024-01-29", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 50.7251, "type": "PURCHASE", "units": 23.715}, {"amount": 0.06, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1114.94, "balance": 363.718, "date": "2024-01-29", "description": "Switch In - From Nifty 50 Index Fund-DP Growth - INA100006898", "dividend_rate": null, "nav": 50.7251, "type": "SWITCH_IN", "units": 21.98}, {"amount": 0.06, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 11895.41, "balance": 596.113, "date": "2024-02-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 51.1862, "type": "PURCHASE", "units": 232.395}, {"amount": 0.59, "balance": null, "date": "2024-02-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1241.94, "balance": 620.307, "date": "2024-02-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 51.3327, "type": "PURCHASE", "units": 24.194}, {"amount": 0.06, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 4655.77, "balance": 705.1, "date": "2024-03-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 54.9073, "type": "PURCHASE", "units": 84.793}, {"amount": 0.23, "balance": null, "date": "2024-03-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1094.95, "balance": 724.897, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 55.3096, "type": "PURCHASE", "units": 19.797}, {"amount": 0.05, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 2471.88, "balance": 770.009, "date": "2024-03-12", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 54.7938, "type": "PURCHASE", "units": 45.112}, {"amount": 0.12, "balance": null, "date": "2024-03-12", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 5583.89, "balance": 875.887, "date": "2024-03-13", "description": "Switch In - From Corporate Bond Fund - DP Growth - INA100006898", "dividend_rate": null, "nav": 52.7391, "type": "SWITCH_IN", "units": 105.878}, {"amount": 0.28, "balance": null, "date": "2024-03-13", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -11056.0, "balance": 667.186, "date": "2024-03-19", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 52.9757, "type": "SWITCH_OUT", "units": -208.701}, {"amount": 0.11, "balance": null, "date": "2024-03-19", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 42794.86, "balance": 1412.029, "date": "2024-04-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 57.4549, "type": "PURCHASE", "units": 744.843}, {"amount": 2.14, "balance": null, "date": "2024-04-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -38841.0, "balance": 741.763, "date": "2024-04-09", "description": "*Switch Out - To Nifty 50 Index Fund-DP Growth , less STT", "dividend_rate": null, "nav": 57.9492, "type": "SWITCH_OUT", "units": -670.266}, {"amount": 0.39, "balance": null, "date": "2024-04-09", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}], "type": "EQUITY", "valuation": {"date": "2024-04-12", "nav": 58.1998, "value": 0}}, {"advisor": "INA100006898", "amfi": "149283", "close": 4701.16, "close_calculated": 4701.16, "isin": "INF109KC1V18", "open": 0.0, "rta": "CAMS", "rta_code": "P9658", "scheme": "ICICI Prudential Nifty Smallcap 250 Index Fund - Direct Plan - Growth (Non-Demat) - ISIN: INF109KC1V18", "transactions": [{"amount": 2188.89, "balance": 150.783, "date": "2024-01-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.5168, "type": "PURCHASE", "units": 150.783}, {"amount": 0.11, "balance": null, "date": "2024-01-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 226.168, "date": "2024-01-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.5115, "type": "PURCHASE", "units": 75.385}, {"amount": 0.05, "balance": null, "date": "2024-01-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 301.466, "date": "2024-01-03", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.5283, "type": "PURCHASE", "units": 75.298}, {"amount": 0.05, "balance": null, "date": "2024-01-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 3282.84, "balance": 525.145, "date": "2024-01-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.6766, "type": "PURCHASE", "units": 223.679}, {"amount": 0.16, "balance": null, "date": "2024-01-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1531.92, "balance": 628.828, "date": "2024-01-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.7751, "type": "PURCHASE", "units": 103.683}, {"amount": 0.08, "balance": null, "date": "2024-01-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1686.92, "balance": 743.257, "date": "2024-01-09", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.7421, "type": "PURCHASE", "units": 114.429}, {"amount": 0.08, "balance": null, "date": "2024-01-09", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1086.95, "balance": 816.239, "date": "2024-01-11", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.8935, "type": "PURCHASE", "units": 72.982}, {"amount": 0.05, "balance": null, "date": "2024-01-11", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1071.95, "balance": 887.769, "date": "2024-01-15", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.986, "type": "PURCHASE", "units": 71.53}, {"amount": 0.05, "balance": null, "date": "2024-01-15", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1127.94, "balance": 963.243, "date": "2024-01-16", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.9448, "type": "PURCHASE", "units": 75.474}, {"amount": 0.06, "balance": null, "date": "2024-01-16", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1032.95, "balance": 1033.975, "date": "2024-01-23", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.6037, "type": "PURCHASE", "units": 70.732}, {"amount": 0.05, "balance": null, "date": "2024-01-23", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1653.92, "balance": 1145.274, "date": "2024-01-24", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 14.8601, "type": "PURCHASE", "units": 111.299}, {"amount": 0.08, "balance": null, "date": "2024-01-24", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1202.94, "balance": 1224.769, "date": "2024-01-29", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.1323, "type": "PURCHASE", "units": 79.495}, {"amount": 0.06, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 11490.43, "balance": 1966.35, "date": "2024-02-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.4945, "type": "PURCHASE", "units": 741.581}, {"amount": 0.57, "balance": null, "date": "2024-02-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1240.94, "balance": 2046.003, "date": "2024-02-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.5794, "type": "PURCHASE", "units": 79.653}, {"amount": 0.06, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 6947.65, "balance": 2494.774, "date": "2024-03-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.4815, "type": "PURCHASE", "units": 448.771}, {"amount": 0.35, "balance": null, "date": "2024-03-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1093.95, "balance": 2565.364, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.4972, "type": "PURCHASE", "units": 70.59}, {"amount": 0.05, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -12293.0, "balance": 1723.635, "date": "2024-03-12", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 14.6046, "type": "SWITCH_OUT", "units": -841.729}, {"amount": 0.12, "balance": null, "date": "2024-03-12", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": -6823.0, "balance": 1239.733, "date": "2024-03-19", "description": "*Switch Out - To Regular Gold SF (FOF) - DP Growth , less STT", "dividend_rate": null, "nav": 14.1001, "type": "SWITCH_OUT", "units": -483.902}, {"amount": 0.07, "balance": null, "date": "2024-03-19", "description": "*** STT Paid ***", "dividend_rate": null, "nav": null, "type": "STT_TAX", "units": null}, {"amount": 12157.39, "balance": 2033.597, "date": "2024-04-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.3142, "type": "PURCHASE", "units": 793.864}, {"amount": 0.61, "balance": null, "date": "2024-04-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 42149.89, "balance": 4701.16, "date": "2024-04-10", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 15.8009, "type": "PURCHASE", "units": 2667.563}, {"amount": 2.11, "balance": null, "date": "2024-04-10", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}], "type": "EQUITY", "valuation": {"date": "2024-04-12", "nav": 15.7361, "value": 0}}, {"advisor": "INA100006898", "amfi": "120685", "close": 2057.612, "close_calculated": 2057.612, "isin": "INF109K01U92", "open": 0.0, "rta": "CAMS", "rta_code": "P8130", "scheme": "ICICI Prudential Regular Gold Savings Fund (FOF) - Direct Plan - Growth (Non-Demat) - ISIN: INF109K01U92", "transactions": [{"amount": 1243.94, "balance": 59.943, "date": "2024-01-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.752, "type": "PURCHASE", "units": 59.943}, {"amount": 0.06, "balance": null, "date": "2024-01-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 622.97, "balance": 89.808, "date": "2024-01-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.8598, "type": "PURCHASE", "units": 29.865}, {"amount": 0.03, "balance": null, "date": "2024-01-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 620.97, "balance": 119.83, "date": "2024-01-03", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.6837, "type": "PURCHASE", "units": 30.022}, {"amount": 0.03, "balance": null, "date": "2024-01-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1864.91, "balance": 210.486, "date": "2024-01-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.5713, "type": "PURCHASE", "units": 90.656}, {"amount": 0.09, "balance": null, "date": "2024-01-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 871.96, "balance": 252.958, "date": "2024-01-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.5301, "type": "PURCHASE", "units": 42.472}, {"amount": 0.04, "balance": null, "date": "2024-01-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1040.95, "balance": 303.746, "date": "2024-01-09", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.4961, "type": "PURCHASE", "units": 50.788}, {"amount": 0.05, "balance": null, "date": "2024-01-09", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 640.97, "balance": 335.145, "date": "2024-01-11", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.4137, "type": "PURCHASE", "units": 31.399}, {"amount": 0.03, "balance": null, "date": "2024-01-11", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 686.97, "balance": 368.498, "date": "2024-01-15", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.5969, "type": "PURCHASE", "units": 33.353}, {"amount": 0.03, "balance": null, "date": "2024-01-15", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 613.97, "balance": 398.427, "date": "2024-01-16", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.5145, "type": "PURCHASE", "units": 29.929}, {"amount": 0.03, "balance": null, "date": "2024-01-16", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 636.97, "balance": 429.567, "date": "2024-01-23", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.4549, "type": "PURCHASE", "units": 31.14}, {"amount": 0.03, "balance": null, "date": "2024-01-23", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1054.95, "balance": 481.047, "date": "2024-01-24", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.4923, "type": "PURCHASE", "units": 51.48}, {"amount": 0.05, "balance": null, "date": "2024-01-24", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 743.96, "balance": 517.14, "date": "2024-01-29", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.6121, "type": "PURCHASE", "units": 36.093}, {"amount": 0.04, "balance": null, "date": "2024-01-29", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1772.91, "balance": 602.936, "date": "2024-02-01", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.6643, "type": "PURCHASE", "units": 85.796}, {"amount": 0.09, "balance": null, "date": "2024-02-01", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 784.96, "balance": 641.228, "date": "2024-02-05", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.4995, "type": "PURCHASE", "units": 38.292}, {"amount": 0.04, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 7200.64, "balance": 992.487, "date": "2024-02-05", "description": "Switch in - From Nifty 50 Index Fund-DP Growth - INA100006898", "dividend_rate": null, "nav": 20.4995, "type": "SWITCH_IN", "units": 351.259}, {"amount": 0.36, "balance": null, "date": "2024-02-05", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -9261.0, "balance": 540.14, "date": "2024-03-01", "description": "Switch Out - To Corporate Bond Fund - DP Growth", "dividend_rate": null, "nav": 20.4732, "type": "SWITCH_OUT", "units": -452.347}, {"amount": 309.98, "balance": 555.015, "date": "2024-03-04", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 20.8391, "type": "PURCHASE", "units": 14.875}, {"amount": 0.02, "balance": null, "date": "2024-03-04", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 5672.89, "balance": 820.225, "date": "2024-03-13", "description": "Switch in - From Corporate Bond Fund - DP Growth - INA100006898", "dividend_rate": null, "nav": 21.3902, "type": "SWITCH_IN", "units": 265.21}, {"amount": 0.28, "balance": null, "date": "2024-03-13", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 12292.39, "balance": 1391.996, "date": "2024-03-14", "description": "Switch in - From Nifty Smallcap 250 Index Fund - Direct Plan - Gro - INA100006898", "dividend_rate": null, "nav": 21.4988, "type": "SWITCH_IN", "units": 571.771}, {"amount": 0.61, "balance": null, "date": "2024-03-14", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 11055.45, "balance": 1896.947, "date": "2024-03-21", "description": "Switch in - From Nifty Next 50 Index Fund-DP Growth - INA100006898", "dividend_rate": null, "nav": 21.8941, "type": "SWITCH_IN", "units": 504.951}, {"amount": 0.55, "balance": null, "date": "2024-03-21", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 3821.81, "balance": 2071.506, "date": "2024-03-21", "description": "Switch in - From Nifty Midcap 150 Index Fund - Direct Plan - Growth - INA100006898", "dividend_rate": null, "nav": 21.8941, "type": "SWITCH_IN", "units": 174.559}, {"amount": 0.19, "balance": null, "date": "2024-03-21", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 6822.66, "balance": 2383.127, "date": "2024-03-21", "description": "Switch in - From Nifty Smallcap 250 Index Fund - Direct Plan - Gro - INA100006898", "dividend_rate": null, "nav": 21.8941, "type": "SWITCH_IN", "units": 311.621}, {"amount": 0.34, "balance": null, "date": "2024-03-21", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 1694.92, "balance": 2458.405, "date": "2024-04-02", "description": "Purchase - INA100006898", "dividend_rate": null, "nav": 22.5156, "type": "PURCHASE", "units": 75.278}, {"amount": 0.08, "balance": null, "date": "2024-04-02", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": 39642.02, "balance": 4209.184, "date": "2024-04-03", "description": "Switch in - From Nifty 50 Index Fund-DP Growth - INA100006898", "dividend_rate": null, "nav": 22.6425, "type": "SWITCH_IN", "units": 1750.779}, {"amount": 1.98, "balance": null, "date": "2024-04-03", "description": "*** Stamp Duty ***", "dividend_rate": null, "nav": null, "type": "STAMP_DUTY_TAX", "units": null}, {"amount": -50327.0, "balance": 2057.612, "date": "2024-04-10", "description": "Switch Out - To Nifty Midcap 150 Index Fund - Direct Plan - Growth", "dividend_rate": null, "nav": 23.3908, "type": "SWITCH_OUT", "units": -2151.572}], "type": "DEBT", "valuation": {"date": "2024-04-12", "nav": 23.8139, "value": 0}}]}], "investor_info": {"address": "address", "email": "junit@email.com", "mobile": "9848022338", "name": "Junit"}, "statement_period": {"from": "01-Jan-1990", "to": "20-Jun-2023"}}
                    """);
        return fileWriter;
    }

    @Test
    @Order(101)
    void getPortfolio() throws Exception {
        this.mockMvc
                .perform(get("/api/portfolio/{pan}", "ABCDE1234F")
                        .param("asOfDate", LocalDate.now().minusDays(2).toString())
                        .accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, is(MediaType.APPLICATION_JSON_VALUE)))
                .andExpect(jsonPath("$.portfolioDetailsDTOS.size()", is(4)));
    }

    @Test
    @Order(102)
    void getPortfolioForAfterDate() throws Exception {
        this.mockMvc
                .perform(get("/api/portfolio/{pan}", "ABCDE1234F")
                        .param("asOfDate", LocalDate.now().plusDays(10).toString())
                        .accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isBadRequest())
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, is(MediaType.APPLICATION_PROBLEM_JSON_VALUE)))
                .andExpect(jsonPath("$.type", is("about:blank")))
                .andExpect(jsonPath("$.title", is("Constraint Violation")))
                .andExpect(jsonPath("$.status", is(400)))
                .andExpect(jsonPath("$.detail", is("getPortfolio.asOfDate: Date should be past or today")))
                .andExpect(jsonPath("$.instance", is("/api/portfolio/ABCDE1234F")));
    }

    @Test
    @Order(103)
    void getPortfolioWithOutDate() throws Exception {
        this.mockMvc
                .perform(get("/api/portfolio/{pan}", "ABCDE1234F").accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, is(MediaType.APPLICATION_JSON_VALUE)))
                .andExpect(jsonPath("$.portfolioDetailsDTOS.size()", is(4)));
    }
}
